services:
  job-middleware:
    build: .
    ports:
      - "127.0.0.1:8002:8002"
    env_file:
      - .env
    environment:
      - UPSTREAM_BEARER=${UPSTREAM_BEARER}
      - UPSTREAM_URL=${UPSTREAM_URL:-https://app.cyberr.ai/backend/api/v1/jobs}
      - REQUIRE_API_KEY=${REQUIRE_API_KEY:-false}
      - MIDDLEWARE_API_KEY=${MIDDLEWARE_API_KEY:-change-me}
      - API_KEY_HEADER=${API_KEY_HEADER:-x-internal-token}
      - CORS_ORIGINS=${CORS_ORIGINS:-}
      - CACHE_TTL_SECONDS=${CACHE_TTL_SECONDS:-300}
      - UPSTREAM_TIMEOUT_MS=${UPSTREAM_TIMEOUT_MS:-30000}
      - RATE_LIMIT_PER_MINUTE=${RATE_LIMIT_PER_MINUTE:-60}
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - TRUST_PROXY=${TRUST_PROXY:-true}
      - HTTP_PROXY=${HTTP_PROXY:-}
      - HTTPS_PROXY=${HTTPS_PROXY:-}
      - NO_PROXY=${NO_PROXY:-localhost,127.0.0.1,::1,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16}
    restart: unless-stopped